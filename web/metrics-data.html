<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monteverdi - Metrics Data</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="metrics-data.css">
</head>
<body>

<div id="container">
    <h1>Monteverdi Metrics Data <span style="font-size: 0.5em; color: #888;" id="version"></span></h1>


    <div style="margin-top: 20px; padding: 15px; background: rgba(45,45,45,0.5); border-radius: 8px; font-size: 13px; color: #aaa;">
        <h4 style="color: #e85ff8; margin-top: 0;">How to tune your config.json:</h4>
        <ol style="line-height: 1.8;">
            <li>Watch the <strong style="color: #00fce7;">Current</strong> values to see typical ranges for your metrics</li>
            <li>The <strong style="color: #ffcc00;">% Used</strong> shows how close you are to triggering an accent</li>
            <li>When <strong style="color: #ff7f00;">? üî•</strong> appears, that metric has exceeded its maximum (<b>max</b>) threshold and triggers an accent</li>
            <li>Use the <a href="/value-editor.html">Value Editor</a> to adjust the running configuration, which provides a selector for viewing one metric at a time.</li>
        </ol>
        <p style="margin: 10px 0 0 0; font-style: italic;">
            Think of an accent as a watermark that you find interesting.
            <br>
            For instance, watching garbage collection patterns during patterns of network traffic, while also tracking cpu utilization and goroutine volume.
        </p>
    </div>

    <div class="nav-link">
        <a href="/">‚Üê Back to Harmony View</a> |
        <a href="/value-editor.html">Value Editor</a> |
        <a href="/plugins.html">Plugins</a>
    </div>

    <div id="metrics-panel">
        <h3 style="color: #5fa73b; margin-top: 0;">
            Current Metric Values
            <span style="font-size: 0.6em; color: #888;">(for tuning maxval in config.json)</span>
        </h3>
        <div id="metrics-table-container">
            <table id="metrics-table">
                <thead>
                <tr>
                    <th>Endpoint</th>
                    <th>Metric</th>
                    <th>Current</th>
                    <th>Max</th>
                    <th>% Used</th>
                    <th>?</th>
                </tr>
                </thead>
                <tbody id="metrics-tbody">
                <!-- Populated by JS -->
                </tbody>
            </table>
        </div>
    </div>

</div>

<div id="system-info" style="margin: 20px 0; padding: 15px; background: rgba(95,167,59,0.1); border-radius: 8px; border: 1px solid #5fa73b;">
    <h3 style="color: #5fa73b; margin-top: 0;">System Configuration</h3>
    <div style="font-family: monospace; font-size: 12px; line-height: 1.8;">
        <div><strong>Output:</strong> <span id="output-type">-</span></div>
        <div id="midi-details" style="display: none;">
            <div><strong>MIDI Port:</strong> <span id="midi-port">-</span>&nbsp;
                <strong>MIDI Channel:</strong> <span id="midi-channel">-</span>&nbsp;
                <strong>Root Note:</strong> <span id="midi-root">-</span></div>
            <div><strong>Scale:</strong> <span id="midi-scale">-</span>&nbsp;
                <strong>Notes:</strong> <span id="midi-notes">-</span></div>
        </div>
    </div>
</div>

<script src="metrics-data.js"></script>
<script>
    // Fetch version
    fetch('/api/version')
        .then(r => r.json())
        .then(data => {
            document.getElementById('version').textContent = data.version;
        })
        .catch(err => console.log('Version fetch failed:', err));
</script>
</body>
</html>